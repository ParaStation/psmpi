#!/bin/bash

prefix="@prefix@"
sysconfdir="@sysconfdir@"
exec_prefix="@exec_prefix@"
libdir="@libdir@"
bindir="@bindir@"

CONFSET="@CONFSET@"
CUDA_HOME="@CUDA_HOME@"

if [ "$CONFSET" == "cuda" -o "$CONFSET" == "cuda-devel" ] ; then
	if [ -n "$CUDA_HOME" ] ; then
		cat > "$sysconfdir/mpicc-cuda.conf" << EOF
PROFILE_INCPATHS="$PROFILE_INCPATHS -I$CUDA_HOME/include"
test -d "$CUDA_HOME/lib" && PROFILE_POSTLIB="$PROFILE_POSTLIB -L$CUDA_HOME/lib -lcuda -lcudart -lstdc++"
test -d "$CUDA_HOME/lib64" && PROFILE_POSTLIB="$PROFILE_POSTLIB -L$CUDA_HOME/lib64 -lcuda -lcudart -lstdc++"
EOF
		cp "$sysconfdir/mpicc-cuda.conf" "$sysconfdir/mpicxx-cuda.conf"
		cp "$sysconfdir/mpicc-cuda.conf" "$sysconfdir/mpifort-cuda.conf"
		cp "$sysconfdir/mpicc-cuda.conf" "$sysconfdir/mpif90-cuda.conf"
		cp "$sysconfdir/mpicc-cuda.conf" "$sysconfdir/mpif77-cuda.conf"
	else
		cat > "$sysconfdir/mpicc-cuda.conf" << EOF
PROFILE_POSTLIB="$PROFILE_POSTLIB -lcuda -lcudart -lstdc++"
EOF
		cp "$sysconfdir/mpicc-cuda.conf" "$sysconfdir/mpicxx-cuda.conf"
		cp "$sysconfdir/mpicc-cuda.conf" "$sysconfdir/mpifort-cuda.conf"
		cp "$sysconfdir/mpicc-cuda.conf" "$sysconfdir/mpif90-cuda.conf"
		cp "$sysconfdir/mpicc-cuda.conf" "$sysconfdir/mpif77-cuda.conf"
	fi
fi
